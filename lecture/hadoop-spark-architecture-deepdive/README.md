# 하둡 & 스파크 아키텍쳐

## 용어 정리
#### Distirbuted File System
- 분산 파일 시스템은 네트워크를 통해 스토리지를 관리하는 파일 시스템이다.
- 데이터 손실 없ㅅ는 파일 시스템 무결함성을 만드는 것이 목표이다.

#### Hadoop
- 분산 파일 시스템의 병렬 처리 프레임워크에서 실행되는 플랫폼이다.

#### HDFS
- 블록 파일 시스템이나 디스크 블록 같은 거지만 좀 더 큰 사이즈이다. 기본이 128MB 이다. (블록은 512 바이트)
- 청크로 분할되어 독립적인 단위로 저장된다.
- 1MB 의 파일 크기를 포함하는 하나의 HDFS 블록은 HDFS 블록 128MB 전체 크기가 아닌 1MB 의 디스크 공간만 사용한다.

#### NameNode
- 메타 데이터가 주로 저장되는데 파일 시스템의 전체 디렉터리 구조에 대한 스냅샷을 유지하고, 클러스터에서 위치를 추적한다. 
- HDFS 의 모든 파일에 대한 블록과 해당 위치를 리스트한다.
- 보통은 NameNode가 SPOF 이다. (추가: StanBy Active NameNode 개념이 생기면서 HA 구성이 가능해지는 걸로 알고 있다.)

#### DataNode
- 모든 데이터를 HDFS 에 저장한다.
- NameNode 에게 저장된 블록 목록과 함께 아직 살아 있음을 알리는 것이 유일한 임무기기 때문에 데이터노드는 Slave 라고도 부른다.
- 데이터 노드가 다운되면 마스터는 데이터 노드의 내용을 NameNode(마스터) 는 다른곳에 복제한다.

#### Yarn
- Hadoop2.0 (MapReduce2) 에 생긴 시스템이다.
- 클러스터 리소스를 요청하고 작업하기 위한 API 를 제공한다. 실제 동작하는 (리소스 처리 관련) 은 숨겨져 있다. 사용자는 단지 고수준 API 만을 사용하면 된다.

#### ResourceManager
- 클러스터의 애플리케이션 작업 예약 및 리소스 모니터링을 담당한다.
- 작업 스케쥴을 관리한다.

#### NoeManager
- 컨테이너와 해당 리소스 사용량(cpu, 메모리, 디스크)을 시작 및 모니터링하고 리소스 매니저에게 다시 알려주는 역할을 한다.
- 리소스 풀을 관리한다.

#### Container
- 특정 리소스가 할당된 어플리케이션을 실행한다.

## Hadoop Internals
하둡의 주요 개념? 시스템으로는 `HDFS` 와 `YARN` 이 있다.

### NameNode 의 HA
네임노드는 `FSImage` 라는 파일 시스템 메타데이터의 스냅샷을 생성한다.
`FSImage` 는 특정 시점의 스냅샷이기 때문에 `Edit log` 라는 개념을 같이 사용한다.

네임노드는 `FSImage` 를 로드한 다음 `Edit log` 의 모든 작업을 재생하여 파일 시스템의 가장 최근 상태를 읽어 복원한다.

### HDFS

#### 블록
하둡 1에서는 블록 크기가 64MB 이고, 하둡2 에서 블록 크기는 128MB이다.


하둡2에서 블록 크기는 왜 이렇게 클까?

- 블록의 크기가 작으면 블록의 개수가 많아지기 때문에 저장해야할 메타데이터 양이 많아진다.

많은 수의 블록을 다루는 것은 네트워크 트래픽을 유발할 수도 있다. 그리고 블록의 크기가 크고 개수가 적기 때문에 매퍼의 개수도 상대적으로 더 적어질 수 있는 것이다.

> 일반적으로는 128MB 가 적합하지만 강사는 1GB 까지도 보았다고 한다. 하지만 너무 크게 하면 안된다고... 32-bit inter 를 생각하라고 했다.

- `seek` 비용이 줄어든다.

데이터를 탐색하는 시간은 파일의 첫 번째 블록을 찾는 `seek time` + 연속된 데이터 블록을 읽는 데 걸리는 `transfer time` 으로 구성된다. `seek time` 을 줄이는 것은 힘들지만 블록 크기가 증가하면 한번의 `seek` 에서 데이터를 읽을 수 있는 양이 증가한다. 

