# Chapter15. 케이스 클래스와 패턴 매치

## 케이스 클래스
클래스 앞에 `case` 라는 수식어가 붙은 경우를 __케이스 클래스__ 라고 한다.

`case` 수식자는 스칼라 컴파일러에게 해당 클래스에 문법적으로 편리한 기능 몇 가지를 추가 하라고 지시하는 것이다.

### 케이스 클래스의 기능

1. 컴파일러는 클래스 이름과 같은 이름의 팩토리 메서드를 추가한다. 그래서 `new Var()` 대신에 `Var()` 를 사용해 객체를 생성할 수 있다.

2. 케이스 클래스의 파라미터 목록에 있는 모든 클래스 파라미터에 암시적으로 `val` 접두사를 붙인다는 점이다.

3. 컴파일러는 케이스 클래스에 `toString`, `hashCode`, `equals` 메서드의 _자연스러운_ 구현을 추가한다.

4. 컴파일러는 케이스 클래스에 일부를 변경한 복사본을 생성하는 `copy` 메서드를 추가한다.

__케이스 클래스의
가장 큰 장점은 패턴 매치를 지원한다는 것이다!__

## 패턴 매치
### 패턴의 종류
#### 와일드카드 패턴
와일드 카드 패턴 `_` 은 어떤 객체라도 매치할 수 있다.

```
case BinOp(...) =>
  ...
case _ =>
  ...
```

두번 째 case 문 처럼 사용한다.
어떤 객체에서 값을 알 필요가 없는 부분을 무시하기 위해 사용할 수 있다. (자바 switch 의 default 랑 비슷한 것 같다. 내 생각엔)

#### 상수 패턴
상수 패턴은 자신과 똑같은 값과 매치된다. 어떤 종류의 리터럴이든 상수로 사용할 수 있다.

```
def describe(x: Any) = x match {
  case 5 => "five"
  case true => "truth"
  case "hello" => "hi!"
  case Nil => "the empty list"
  case _ => "something else"
}
```

#### 변수 패턴
변수 패턴은 와일드카드 처럼 어떤 객체와도 매치된다. 와일드카드와 다른 점은, 변수에 객체를 바인딩한다는 사실이다.

```
case someVariable => "test" + someVariable
```

위와 같이 케이스 구문에 변수 명을 넣으면 매치 되는 값이 무엇이든 간에 그 값을 패턴에 사용한 변수 이름으로 가리킬 수 있다. (물론 위에서 매치 되는게 없어야겠지?)

>패턴매칭에서 소문자로 시작하면 변수 취급하지만, 굳이 상수로 쓰고 싶다고 한다면 어떤 객체의 필드 이거나, 역 따옴표를 사용하도록 하자

#### 생성자 패턴

스칼라는 케이스 구문 안에 객체를 넣을 수 있는데 단순히 객체만 넣을 수 있는게 아니고, 객체 안의 객체도 가능하다. 이를 생성자 패턴이라 한다.

객체 트리 구조를 내려가면서 패턴 매칭을 진행한다.

```
case BinOp("+", e, Number(0)) => println("a deep match")
```

스칼라패턴은 __deep match__ 를 지원한다. 즉, 어떤 패턴이 제공받은 최상위 객체만을 매치시킬 아니라, 내포된 패턴과 객체의 내용에 대해서도 매치를 시도한다는 의미이다.

#### 시퀀스 패턴
배열이나 리스트 같은 시퀀스 타입에 대해서도 매치시킬 수 있다.

```
case List(0, _, _) => ...
```

위와 같은 코드에선 0으로 시작하는 리스트면서 원소가 3개일 때 저 구문에 매칭된다.

만약 길이와 관계 없이 매치하고 싶다면 아래 처럼 작성한다.

```
case List(0, _*) => ...
```

#### 튜플 패턴
튜플도 리스트 처럼 매치할 수 있다.

```
case (a, b, c) => ...
```

#### 타입 지정 패턴
타입 검사나 타입 변환을 간편하게 대신하기 위해 __타입 지정 패턴__ 을 사용할 수 있다.

```
def generalSize(x: Any) = x match {
  case s: String => s.length
  case m: Map[_, _] => m.size
  case _ => -1
}
```

>원소 값 타입 지정시에는 오류가 난다. 오직 배열만이 타입을 지정할 수 있다.

#### 변수 바인딩

### 패턴 가드
스칼라는 패턴을 선형 패턴으로 제한한다. 그래서 어떤 패턴 변수는 한 패턴 안에 오직 한 번만 나와야 한다.

이를 해결하기 위해 스칼라는 패턴 뒤에 `if` 구문과 같이, 패턴안에 있는 변수를 참조하는 어떤 Boolean 표현식을 사용한다. 이를 __패턴 가드__ 라 한다.

```
case BinOp("+", x, x) => BinOp("*", x, Number(2)) // 에러!

case BinOp("+", x, y) if x == y => BinOp("*", x, Number(2))
```

### 봉인 클래스
`sealed` 키워드를 붙이면 해당 클래스는 같은 파일이 아닌 다른 곳에선 서브 클래스를 생성할 수 없다.

해당 키워드를 사용한 클래스의 서브 클래스에서 패턴 매칭을 사용하면, 처리하지 않은 패턴 (case 로 잡지 않은) 들에 대해서 경고를 해준다.

### Option 옵션
스칼라에는 `Option` 이라는 표준 타입이 있다.

x 가 실제 값이라면 `Some(x)` 로, 값이 없으면 `None` 이라는 객체가 된다.
