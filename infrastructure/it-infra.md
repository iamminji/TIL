# IT 인프라 구조

IT 인프라는 크게 `집약형` 과 `분할형` 으로 나누어진다.

### 집약형
하나의 컴퓨터로 모든 처리를 하는 경우이다.

> 하나 라고는 하지만, 내부적으로는 여러 시스템이 공존하는 경우다. 어떤 하나의 시스템이 장애가 나도 다른 시스템에는 영향을 끼치지 않게 설계 한다.

#### 장점
- 구성이 간단하다.
- 리소스 관리나 이중화에 의해 안정성이 높고 고성능이다.

###### 단점
- 도입 비용과 유지 비용이 크다.
- 확장성에 한계가 있다.

#### 분할형
여러 대의 컴퓨터를 조합해서 하나의 시스템을 구축하는 구조다.

###### 장점
- 낮은 비용으로 시스템을 구축할 수 있다.
- 서버 대수를 늘릴 수 있어서 확장성이 높다.

###### 단점
- 대수가 늘어나면 관리 구조가 복잡해진다.
- 한 대가 망가지면 영향 범위를 최소화하기 위한 구조를 검토해야 한다.

분할형 중에 `수직 분할형` 의 경우 서버별로 다른 역할을 한다. 다음은 `수직 분할형` 에 해당하는 `클라이언트-서버` 아키텍쳐와 `3계층` 아키텍쳐 이다.

#### 클라이언트-서버형 아키텍쳐
우리가 흔히 아는 구조 (클라이언트-서버) 이다. 클라이언트는 예를 들면 스마트폰과 같은 기기이며 서버는 말 그대로 서버다.

###### 장점
- 클라이언트 측에서 많은 처리를 실행할 수 있어서 소수의 서버로 다수의 클라이언트를 처리할 수 있다.

###### 단점
- 클라이언트 측의 소프트웨어 정기 업데이트가 필요하다.
- 서버 확장성에 한계가 발생할 수 있다.

클라이언트-서버 아키텍쳐는 버그 수정과 같은 업데이트를 해야할 경우 클라이언트도 진행해야 하는 경우가 있다. 뿐만 아니라 서버에서 처리를 하는 경우엔 확장성의 문제도 있다. 이를 극복하기 위해 나온 것이 `3계층 아키텍쳐`이다.

#### 3계층 아키텍쳐
3계층 아키텍쳐는 클라이언트-서버형을 발전시킨 것이다.

`프레젠테이션 계층`, `애플레키에션 계층`, `데이터 계층` 총 3가지 계층이 존재하기 때문에 3계층 아키텍쳐라 부른다.

##### 프레젠테이션 계층
- 사용자의 입력을 받는다.
- 웹 브라우저 화면을 표시한다.

##### 애플리케이션 계층 (AP 계층)
-  request 에 따라 업무 처리를 한다.

##### 데이터 계층
- 애플리케이션 계층의 요청에 따라 데이터 입출력을 한다.

`수직 분할형` 이 있으면 `수평 분할형` 도 있다. `수직 분할형` 이 서버 별로 다른 책임을 갖는다면 `수평 분할형` 은 같은 책임을 여러 서버가 나눠 갖는다.
`수평 분할` 을 `샤딩` 이나 `파티셔닝` 이라고도 부른다.

#### 단순 수평 분할형 아키텍쳐
서로 다른 성격의 같은 서비스(예를 들면 부산과 서울의 편의점 매출 정보등)에서는 수직 분할형 구조를 갖는다. 즉, 부산에 있는 매니저가 서울의 편의점의 매출을 알고 싶다면 서울의 편의점 프레젠테이션-애플리케이션-데이터 계층에 접근해야 한다는 것이다.

##### 장점
- 수평으로 서버를 늘리기 때문에 확장성이 향상된다.
- 분할한 시스템이 독립적으로 운영되므로 서로 영향을 주지 않는다.

##### 단점
- 데이터를 일원화해서 볼 수 없다.
- 애플리케이션 업데이트는 양쪽을 동시에 해 주어야 한다.
- 처리량이 균등하게 분할돼 있지 않으면 서버별 처리량에 치우침이 생긴다.

#### 공유형 아키텍쳐
데이터 계층에서 서로 동기화를 진행한다. ()결국 서울의 편의점 매니저는 서울의 편의점 매출 데이터에 접근해도 부산의 편의점 매출을 볼 수 있다는 것이다.)

##### 장점
- 수평으로 서버를 늘리기 때문에 확장성이 향상된다.
- 분할한 시스템이 서로 다른 시스템의 데이터를 참조할 수 있따.

##### 단점
- 분할한 시스템 간 독립성이 낮아진다.
- 공유한 계층의 확장성이 낮아진다.

## 3계층형 시스템의 구성도

### 프로세스와 스레드
프로세스 및 스레드는 프로그램 실행 파일 자체가 아니라 OS 상에서 실행되서 어느 정도 독립성을 가지고 동작하는 것이다.

프로세스 및 스레드가 활동하려면 메모리 공간이 필요하다. 이것은 커널에 의해 메모리 상에 확보된다.

프로세스와 스레드의 차이점은 프로세스는 전용 메모리 공간을 이용해서 동작하는 것이도 스레드는 다른 스레드와 메모리 공간을 공유하고 있다는 것이다.

OS 상에서 httpd 와 같은 프로세스는 여러개가 개별 공간 (독자적인 메모리 공간) 을 갖고 있고 JVM 안에서의 스레드는 메모리 공간을 공유하게 된다.

어떻게 보면 스레드는 프로세스에 포함되면서, 경량화되었다고 볼 수 있다.

작성하는 프로그램을 멀티 프로세스로 띄울지, 멀티 스레드로 띄울지는 개발자가 특성을 이해하며 정하면 된다.

예를 들면 프로세스는 독자 메모리 공간을 가지기 때문에 생성 시 CPU 부하가 스레드에 비해 높다. 때문에 멀티 프로세스 어플리케이션에서는 프로세스 생성 부담을 낮추기 위해 미리 프로세스를 시작시켜 둔다.

> 물론 프로세스도 공유 메모리를 아예 못 갖는 것은 아니다. 오라클 DB와 같은 어플리케이션은 프로세스 전체가 공유하는 메모리 공간이 존재하기도 하다.

##### 프로세스
###### 장점
- 개별 처리 독립성이 높다.
###### 단점
- 생성 시 CPU 부하가 높다.

##### 스레드
###### 장점
- 생성 시 부하가 낮다.
###### 단점
- 메모리 공간을 공유하기 때문에 의도하지 않은 데이터 읽기/쓰기가 발생할 수 있다. (예를 들면 Multiple read, sigle write)

### OS 커널

#### 커널의 역할

##### 시스템 콜 인터페이스
프로세스/스레드에서 커널로 연결되는 인터페이스다.
##### 프로세스 관리
OS 상의 프로세스는 (원한다면) 무수히 많은 수로 띄울 수 있으나 (탄력적으로), CPU 코어 수는 고정되 있으며 많아야 수십개 정도이다. 그렇다면 어떤 프로세스에게 CPU 코어를 할당해야 하는지를 정하는 것이 커널의 역할이다. (우선 순위)
##### 메모리 관리
프로세스가 이용하는 독립 메모리 공가능 확보하거나 상호 간의 참조 영역을 지키기 위해 독립성을 관리하는 등의 역할을 한다.
##### 네트워크 스택
##### 파일 시스템 관리
##### 장치 드라이버

### 직렬/병렬

#### 직렬
- 구조가 간단해서 설계나 구현 난이도가 낮다.
- 복수의 리소스를 유용하게 이용할 수 없다.

#### 병렬
- 복수의 리소스를 유용하게 이용할 수 있으며, 직렬에 비해 동일 시간당 처리할 수 있는 양이 증가한다. 또한, 일부가 고장 나더라도 처리를 계속할 수 있다.
- 처리 분기나 합류를 위한 오버헤드가 발생한다. 배타 제어 등을 고려해야 하고 구조가 복잡해서 설계나 구현 난이도가 높다.
- 퍼포먼스는 향상되지 않지만 쓰루풋을 늘릴 수는 있다.

> 병렬과 동시성 (parallel, concurrent) 은 다른 의미를 가지고 있다. 동시에 복수의 처리를 하는 것이 병렬이고, 복수의 처리가 실행 상태에 있는 것을 동시성이라 한다.
즉 한 사람이 여러 일을 하는 것은 동시성이고 여러 사람이 동시에 일을 하는 것은 병렬이다.

### 동기/비동기

동기는 일을 시키고 응답을 받을 때 까지 다른 일을 하지 않고 기다리는 것이고, 비동기는 일을 시키고 응답을 받기 전에도 다른 일을 할 수 있는 것이다.
