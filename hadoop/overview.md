# 하둡

## Yarn
하둡을 위한 분산 프로세스 실행 프레임 워크이다.

### 리소스 매니저
- 클러스터 전체를 관리하는 마스터 서버의 역할을 담당
- 응용 프로그램들 간의 자원 (cpu, disk, memory) 등을 의미

### 노드 매니저
- 노드당 하나씩 존재
- 리소스 매니저의 지시를 받아 작업 요구사항에 따라 컨테이너를 생성

##### 인그레스 (ingress)
하둡으로 데이터를 집어넣는 작업
##### 이그레스 (egress)
하둡에 들어있는 데이터를 가져오는 작업


### HDFS 아키텍쳐
HDFS 는 블록 구조의 파일 시스템이다.

#### 네임노드와 데이터 노드

##### 네임 노드
네임 노드의 역할

###### 메타데이터 관리
네임 노드는 파일시스템을 관리하기 위해 메타데이터를 가지고 있다.
###### 데이터 노드 모니터링
데이터 노드는 네임노드에게 3초에 한번 씩 하트비트를 날린다. 네임 노드는 해당 하트비트를 통해 데이터 노드의
실행 상태와 용량을 확인하고, 하트비트가 오지 않으면 해당 데이터 노드가 장애가 났다고 판단한다.
###### 블록 관리
- 네임 노드는 장애가 발생한 데이터 노드를 발견하면 해당 데이터 노드의 블록을 새로운 데이터 노드로 복제한다.
- 용량이 부족한 데이터 노드를 발견하면 네임 노드는 용량에 여유가 있는 쪽으로 데이터 노드를 이동 시킨다.
- 네임 노드는 리플리케이션 수를 이용해 블록이 더 많거나 적으면 복제하거나 삭제해준다.

###### 클라이언트 요청 접수

##### 세컨더리 네임 노드
- 보조 네임 노드는 네임 노드에 접속을 해서 네임 노드의 메모리에 있는 메타데이터의 사본을 주기적으로 가져온다.
- 보조 네임 노드는 자체적으로 복사본을 유지하면서, 파일 집합의 정보를 통합하여 다시 네임노드에 제공한다.
- 장애 났을 때 보조네임 노드에 파일들을 통해 복구한다.

참고로 stand-by 가 아니라서 active 네임 노드가 죽으면 해당 네임노드를 다시 재기동 해야 되었다. HA 구성을 하고 싶으면 Journal Node 라는 개념이 있는데 이게 하둡2 부터 가능하다. (이거 말고 하나 더 있는데 뭐였더라...)

저널 노드도 보통 3개 띄워서 HA 구성을 한다고 한다.



##### 데이터 노드
데이터 노드는 클라이언트가 HDFS에 저장하는 파일을 로컬 디스크에 유지한다. 이 때 로컬 디스크에 저장하는
데이터의 종류는 2가지이다. 하나는 실제 데이터고 나머지 하나는 메타 데이터다.

##### HDFS 의 파일 저장
HDFS 의 파일 저장은 3단계로 나누어진다.

1. 클라이언트가 네임노드에게 파일 저장을 요청하는 단계
2. 클라이언트가 데이터노드에게 패킷을 전송하는 단계
3. 클라이언트가 파일 저장을 완료하는 단계
